{"version":3,"file":"Server.js","sourceRoot":"","sources":["../src/Server.ts"],"names":[],"mappings":";;;;AAAA,iCAA+C;AAC/C,yCAAiD;AACjD,kCAAgC,CAAC,uBAAuB;AACxD,6DAAmE;AACnE,0CAA0C;AAC1C,wCAAwC;AACxC,8CAA8C;AAC9C,kDAAkD;AAClD,6BAA6B;AAC7B,qBAAmB;AACnB,0BAAwB;AACxB,gDAA+C;AAC/C,2CAA2C;AAC3C,uCAAuC;AACvC,MAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC;AAClC,wCAAmC;AAEtB,QAAA,OAAO,GAAG,SAAS,CAAC;AAwBjC,IAAa,MAAM,GAAnB,MAAa,MAAM;IAOjB,iBAAiB;QACf,sCAAsC;QACtC,IAAI,CAAC,GAAG;aACL,GAAG,CACF,IAAI,CAAC;QACH,qBAAqB;QACrB,wHAAwH;QACxH,2BAA2B;SAC5B,CAAC,CACH;aACA,GAAG,CAAC,8CAA2B,CAAC;aAChC,GAAG,CAAC,YAAY,EAAE,CAAC;aACnB,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;aACjB,GAAG,CAAC,cAAc,EAAE,CAAC;aACrB,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;aACtB,GAAG,CACF,UAAU,CAAC,UAAU,CAAC;YACpB,QAAQ,EAAE,IAAI;SACf,CAAC,CACH,CAAC;QACJ,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CACd,OAAO,CAAC;YACN,MAAM,EAAE,IAAI;YACZ,IAAI,EAAE,KAAK;YACX,eAAe;YACf,MAAM,EAAE,aAAa;YACrB,iBAAiB,EAAE,KAAK;YACxB,KAAK,EAAE,IAAI,UAAU,CAAC,EAAC,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,WAAW,IAAI,mCAAmC,EAAE,GAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAC,CAAC;YACpH,MAAM,EAAE;gBACN,IAAI,EAAE,GAAG;gBACT,QAAQ,EAAE,KAAK;gBAEf,MAAM,EAAE,KAAK;gBACb,MAAM,EAAE,KAAK,GAAG,EAAE,GAAG,EAAE;aACxB;SACF,CAAC,CACH,CAAC;QAEF,OAAO,IAAI,CAAC;IACd,CAAC;CACF,CAAA;AA7CC;IADC,WAAM,EAAE;sCACJ,4BAAmB;mCAAC;AAGzB;IADC,kBAAa,EAAE;;wCACQ;AALb,MAAM;IAtBlB,kBAAa,CAAC;QACb,OAAO,EAAP,eAAO;QACP,WAAW,EAAE,CAAC,kBAAkB,CAAC;QACjC,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI;QAClC,SAAS,EAAE,KAAK;QAEhB,cAAc,EAAE;YACd,GAAG,eAAO,oBAAoB;YAC9B,GAAG,eAAO,mBAAmB;YAC7B,GAAG,eAAO,iBAAiB;YAC3B,GAAG,eAAO,sBAAsB;SACjC;QACD,KAAK,EAAE;YACL,OAAO,EAAE,CAAC,GAAG,eAAO,sBAAsB,CAAC;SAC5C;QACD,QAAQ,EAAE;YACR,aAAa,EAAE,WAAI;SACpB;QACD,QAAQ,EAAE,kBAAc;QACxB,MAAM,EAAE,EAAE;QACV,OAAO,EAAE,CAAC,cAAc,CAAC;KAC1B,CAAC;GACW,MAAM,CA+ClB;AA/CY,wBAAM","sourcesContent":["import {Configuration, Inject} from \"@tsed/di\";\r\nimport {PlatformApplication} from \"@tsed/common\";\r\nimport \"@tsed/platform-express\"; // /!\\ keep this import\r\nimport {GlobalAcceptMimesMiddleware} from \"@tsed/platform-express\";\r\nimport * as bodyParser from \"body-parser\";\r\nimport * as compress from \"compression\";\r\nimport * as cookieParser from \"cookie-parser\";\r\nimport * as methodOverride from \"method-override\";\r\nimport * as cors from \"cors\";\r\nimport \"@tsed/ajv\";\r\nimport \"@tsed/mongoose\";\r\nimport mongooseConfig from \"./config/mongoose\";\r\nimport * as session from \"express-session\";\r\nimport * as Mongo from \"connect-mongo\";\r\nconst MongoStore = Mongo(session);\r\nimport {User} from \"./models/User\";\r\n\r\nexport const rootDir = __dirname;\r\n\r\n@Configuration({\r\n  rootDir,\r\n  acceptMimes: [\"application/json\"],\r\n  httpPort: process.env.PORT || 8083,\r\n  httpsPort: false, // CHANGE\r\n\r\n  componentsScan: [\r\n    `${rootDir}/protocols/**/*.ts`,\r\n    `${rootDir}/services/**/*.ts`,\r\n    `${rootDir}/models/**/*.ts`,\r\n    `${rootDir}/middlewares/**/*.ts`,\r\n  ],\r\n  mount: {\r\n    \"/blog\": [`${rootDir}/controllers/**/*.ts`],\r\n  },\r\n  passport: {\r\n    userInfoModel: User,\r\n  },\r\n  mongoose: mongooseConfig,\r\n  multer: {},\r\n  exclude: [\"**/*.spec.ts\"],\r\n})\r\nexport class Server {\r\n  @Inject()\r\n  app: PlatformApplication;\r\n\r\n  @Configuration()\r\n  settings: Configuration;\r\n\r\n  $beforeRoutesInit() {\r\n    // this.app.raw.set(\"trust proxy\", 1);\r\n    this.app\r\n      .use(\r\n        cors({\r\n          // credentials: true,\r\n          // origin: [\"http://www.lotus-blogs.com\", \"https://www.lotus-blogs.com\", \"https://www.focused-borg-7fa9ff.netlify.app\"],\r\n          // maxAge: 36000 * 60 * 24,\r\n        })\r\n      )\r\n      .use(GlobalAcceptMimesMiddleware)\r\n      .use(cookieParser())\r\n      .use(compress({}))\r\n      .use(methodOverride())\r\n      .use(bodyParser.json())\r\n      .use(\r\n        bodyParser.urlencoded({\r\n          extended: true,\r\n        })\r\n      );\r\n    this.app.raw.use(\r\n      session({\r\n        resave: true,\r\n        name: \"app\",\r\n        // proxy: true,\r\n        secret: \"mysecretkey\",\r\n        saveUninitialized: false,\r\n        store: new MongoStore({url: process.env.DEFAULT_URL || \"mongodb://localhost:27017/default\", ttl: 14 * 24 * 60 * 60}),\r\n        cookie: {\r\n          path: \"/\",\r\n          httpOnly: false,\r\n\r\n          secure: false,\r\n          maxAge: 36000 * 60 * 24,\r\n        },\r\n      })\r\n    );\r\n\r\n    return null;\r\n  }\r\n}\r\n"]}